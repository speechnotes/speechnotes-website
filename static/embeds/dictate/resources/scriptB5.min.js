var userAgent = navigator.userAgent || navigator.vendor || window.opera;
if (/android/i.test(userAgent)) {
  window.location = "https://play.google.com/store/apps/details?id=co.speechnotes.speechnotes";
}
var isDisplayingPlaceholder=true;if(localStorage.getItem("isFirstVisit")===null){isDisplayingPlaceholder=true;localStorage.setItem("isFirstVisit","false")}else{isDisplayingPlaceholder=false}if(localStorage.getItem("sessionIndex2")===null){localStorage.sessionIndex2="0"}if(localStorage.getItem("sessionsList2")===null){localStorage.setItem("sessionsList2","")}if(localStorage.getItem("selected_language")===null){switch(localStorage.getItem("interfaceLang")){case ("de"):localStorage.setItem("selected_language","de-DE");break;case ("es"):localStorage.setItem("selected_language","es-ES");break;case ("fr"):localStorage.setItem("selected_language","fr-FR");break;case ("ja"):localStorage.setItem("selected_language","ja-JP");break;case ("ru"):localStorage.setItem("selected_language","ru-RU");break;case ("it"):localStorage.setItem("selected_language","it-IT");break;case ("zh"):case ("cn"):localStorage.setItem("selected_language","cmn-Hans-CN");break;case ("ar"):localStorage.setItem("selected_language","ar-EG");break;case ("pt"):localStorage.setItem("selected_language","pt-BR");break;default:localStorage.setItem("selected_language","en-US");break}}if(localStorage.getItem("autoSave")===null){localStorage.autoSave="true"}if(localStorage.getItem("zoom")===null){localStorage.zoom="1"}if(localStorage.getItem("colorTheme")===null){localStorage.setItem("colorTheme","light")}if(localStorage.getItem("textAlign")===null){localStorage.setItem("textAlign","left")}var interfaceLang="en";const NEW_LINE="\n";const END_OF_SENTENCE_SYMBOLS=[".",":","?","!",":-)",":-(",NEW_LINE,"\n"];var STRINGS=new generateStrings(interfaceLang);var sessionsList;var shownTitle="";var maxChars=25;var RTL_languages=["he","iw","ar"];var COMMANDS=new generateTranscriptionCommands("en-US");var listActionCommands=COMMANDS.listActionCommands;var listBreakCommands=COMMANDS.listBreakCommands;var listToReplaceCommands=COMMANDS.listToReplaceCommands;var listToReplaceMarks=COMMANDS.listToReplaceMarks;var currentSessionIndex;var variables=null;var isToRestartImmediately;var lastScroll=0;var isResultInBuffer=false;var resultInBuffer="";var symbolToAppend="";function zoom(c){localStorage.zoom=parseFloat(localStorage.zoom)*c;var b=parseFloat($("#results_box").css("font-size"));var a=parseFloat($("#results_box").css("line-height"));b=c*b+"px";a=c*a+"px";$("#results_box").css({"font-size":b});$("#results_box").css({"line-height":a})}function sessionsDropdown(){sessions_menu.innerHTML="";sessionsList=localStorage.getItem("sessionsList2").split(",");for(var a=sessionsList.length-2;a>=0;a--){shownTitle=localStorage.getItem("session_title2_"+sessionsList[a]);if(shownTitle.length>maxChars){shownTitle=shownTitle.substring(0,maxChars)+"..."}sessions_menu.innerHTML+='<li><div class="sessionOption" onclick="loadSession('+sessionsList[a]+',0)">'+shownTitle+'</div><div class="smallTrash optionIcon" onclick="deleteSession('+sessionsList[a]+');"></div></li>'}}function trimSpaces(a){while(a[0]===" "){a=a.slice(1)}while(a[a.length-1]===" "){a=a.slice(0,a.length-1)}return a}var first_char=/\S/;function capitalize(a){return a.replace(first_char,function(b){return b.toUpperCase()})}function initializeNewSession(){var a=new Date();variables=new Variables();isToRestartImmediately=true;currentSessionIndex=parseInt(localStorage.sessionIndex2)+1;localStorage.setItem("sessionIndex2",currentSessionIndex);session_title.innerHTML="Note_"+currentSessionIndex+", "+a.getDate()+" "+STRINGS.monthNames[a.getMonth()]+" "+a.getFullYear();$("#mirror").fadeOut();$("#results_box").val("");lastScroll=0}function Variables(){this.savedOnce=false;this.recognizing=false;this.intentionalPause=true}function discardPlaceholder(){results_box.value="";isDisplayingPlaceholder=false}
function runOnload(){$(document).keydown(function(b){if((b.which=="115"||b.which=="83")&&(b.ctrlKey||b.metaKey)){b.preventDefault();saveButton();return false}return true});$("#results_box").keydown(function(b){if(b.keyCode==13){b.preventDefault();if(variables.recognizing&&isResultInBuffer){startButton();isToRestartImmediately=true}else{if(isDisplayingPlaceholder){discardPlaceholder()}insertText(NEW_LINE)}}});$("#results_box").keypress(function(b){if((b.which>=33)&&(b.which<=63)&&variables.recognizing&&isResultInBuffer){b.preventDefault();insertSymbol(String.fromCharCode(b.which))}});$("#results_box").on("input",function(b){if(isDisplayingPlaceholder){discardPlaceholder()}if(localStorage.getItem("autoSave")==="true"){localSave()}});if(isDisplayingPlaceholder){$("#results_box").on("click",function(){if(isDisplayingPlaceholder){discardPlaceholder()}})}$("#save_checkbox").on("click",function(){console.log(save_checkbox.checked);localStorage.autoSave=save_checkbox.checked;if($("#results_box").val().length>0){localSave()}});if(currentSessionIndex==5||currentSessionIndex==20||currentSessionIndex==55){$("#refer_box").delay(60000).slideDown(300)}var a=initializeLanguages();$("#select_language option[value='"+localStorage.selected_language+"']").attr("selected",true);updateLanguage();$("#save_checkbox").prop("checked",(localStorage.autoSave==="true"));zoom(parseFloat(localStorage.zoom));localStorage.zoom=Math.sqrt(parseFloat(localStorage.zoom));if(localStorage.getItem("toggleHelpPane")==="hide"){$("#application_pane").css({right:"0"});$("#help_pane").css({display:"none"})}sessionsDropdown();initializeNewSession();if(isDisplayingPlaceholder){}}
runOnload();
document.getElementById("results_box").focus();
function startButton(b){
  if (window.speechnotesPremiumKeyInjectedByPremiumExtension && chrome && chrome.runtime && chrome.runtime.sendMessage) {
    if (window.location.href.startsWith("http://localhost")) {
      chrome.runtime.sendMessage("iokhojpbdkmgcihflonglcchgpiejpnd",
        {
          message: variables.recognizing ? "recording_off_speechnotes_co" : "recording_on_speechnotes_co"
        },
        function (reply) {});
      chrome.runtime.sendMessage("nncconplehmbkbhkgkodmnkfaflopkji",
          {
            message: variables.recognizing ? "recording_off_speechnotes_co" : "recording_on_speechnotes_co"
          },
          function (reply) {});
    } else {
      chrome.runtime.sendMessage("nncconplehmbkbhkgkodmnkfaflopkji",
        {
          message: variables.recognizing ? "recording_off_speechnotes_co" : "recording_on_speechnotes_co"
        },
        function (reply) {});
    }
  }
  $("#results_box").focus();if(isDisplayingPlaceholder){discardPlaceholder()}variables.intentionalPause=false;if(variables.recognizing){pauseRecognition();return}start_img.src="https://speechlogger.appspot.com/images/micslash2.png";recognition.lang=select_language.value;try{recognition.start()}catch(a){}
}
if(!("webkitSpeechRecognition" in window)){upgrade()}else{start_button.style.display="inline-block";var recognition=new webkitSpeechRecognition();recognition.continuous=true;recognition.interimResults=true;recognition.maxAlternatives=1;recognition.lang=select_language.value;recognition.onstart=function(){isResultInBuffer=false;resultInBuffer="";symbolToAppend="";variables.recognizing=true;start_img.src="https://speechlogger.appspot.com/images/micon2.gif";console.log("Fired onstart")};recognition.onend=function(){console.log("Fired onend");variables.recognizing=false;if(isResultInBuffer){for(var a=0;a<listToReplaceCommands.length;a++){resultInBuffer=resultInBuffer.replace(listToReplaceCommands[a],listToReplaceMarks[a])}insertText(resultInBuffer);resultInBuffer="";isResultInBuffer=false}insertText(symbolToAppend);symbolToAppend="";$("#mirror").fadeOut("slow");if(variables.intentionalPause===false||isToRestartImmediately){console.log("Ended unintentionally");recognition.start();return false}else{start_img.src="https://speechlogger.appspot.com/images/micoff2.png";variables.intentionalPause=true;return true}};recognition.onspeechstart=function(){};recognition.onspeechend=function(){};recognition.onnomatch=function(a){console.log("Fired onnomatch")};recognition.onerror=function(a){console.log("Fired onerror")};recognition.onresult=function(c){console.log("Fired onresult");if(typeof(c.results)==="undefined"){recognition.onend=null;variables.intentionalPause=true;recognition.stop();upgrade();return}$("#mirror").fadeIn("fast");mirror.innerHTML="";str="";for(var b=c.resultIndex;b<c.results.length;++b){str=trimSpaces(c.results[b][0].transcript);if(!(str.substring(0,2)==="I "&&select_language.value.split("-")[0]==="en")){str=str[0].toLowerCase()+str.substring(1,str.length)}if(c.results[b].isFinal){isResultInBuffer=false;resultInBuffer="";console.log(" --- Final result= "+str);switch(listActionCommands.indexOf(str)){case 0:return;default:break}for(var a=0;a<listToReplaceCommands.length;a++){str=str.replace(listToReplaceCommands[a],listToReplaceMarks[a])}$("#mirror").fadeOut("slow");insertText(str)}else{mirror.innerHTML+=c.results[b][0].transcript;isResultInBuffer=true;resultInBuffer=mirror.innerText;console.log(" ----- Interim result= "+c.results[b][0].transcript);str=" "+str;for(var a=0;a<listBreakCommands.length;a++){if(str.indexOf(listBreakCommands[a])!==(-1)){startButton(c);isToRestartImmediately=true;return}}}}}}function updateLanguage(){localStorage.setItem("selected_language",select_language.value);COMMANDS=new generateTranscriptionCommands(select_language.value);listActionCommands=COMMANDS.listActionCommands;listBreakCommands=COMMANDS.listBreakCommands;listToReplaceCommands=COMMANDS.listToReplaceCommands;listToReplaceMarks=COMMANDS.listToReplaceMarks;cell_period.innerHTML=COMMANDS.period;cell_comma.innerHTML=COMMANDS.comma;cell_question.innerHTML=COMMANDS.question;cell_colon.innerHTML=COMMANDS.colon;cell_semi.innerHTML=COMMANDS.semi;cell_exclamation.innerHTML=COMMANDS.exclamation;cell_dash.innerHTML=COMMANDS.dash;cell_line.innerHTML=COMMANDS.line;cell_paragraph.innerHTML=COMMANDS.paragraph;cell_open.innerHTML=COMMANDS.open;cell_close.innerHTML=COMMANDS.close;cell_smiley.innerHTML=COMMANDS.smiley;cell_sad.innerHTML=COMMANDS.sad;if(variables!==null){if(variables.recognizing){isToRestartImmediately=false;startButton()}}}function isLastSymbolAnyOf(d,c){var b="";for(var a=0;a<c.length;a++){b=c[a];if(d.slice(d.length-b.length)===b){return true}}return false}function insertSymbol(a){if(variables.recognizing){symbolToAppend=a;startButton();isToRestartImmediately=true}else{insertText(a)}}function insertText(e){$("#results_box").focus();if(e.length>0){var d=document.getElementById("results_box").selectionStart;var b=$("#results_box").val();var f=Math.max(0,d-5);var a=b.substring(f,d);var g=(a.length>0&&a[a.length-1]===" ");a=trimSpaces(a);if(isLastSymbolAnyOf(a,END_OF_SENTENCE_SYMBOLS)||a==""||d<2||a==="null"){e=capitalize(e)}if(a.length>0&&!g&&[NEW_LINE,"("].indexOf(a[a.length-1])===(-1)&&[".",",",";",":","?","!",")"].indexOf(e[0])===(-1)){e=" "+e}$("#results_box").val(b.substring(0,d)+e+b.substring(d));if((b.length-(d+e.length))<300){var c=document.getElementById("results_box");c.scrollTop=c.scrollHeight}d+=e.length;setCaretToPos(document.getElementById("results_box"),d);if(localStorage.getItem("autoSave")==="true"){localSave()}return e.length}else{return 0}}function rememberScroll(){lastScroll=$("#results_box").scrollTop()}function scrollToMemory(){document.getElementById("results_box").scrollTop=lastScroll}function backspace(c){var b=document.getElementById("results_box").selectionStart;var a=jQuery("#results_box").val();jQuery("#results_box").val(a.substring(0,b-c)+a.substring(b))}function backspaceLastWord(){var c=document.getElementById("results_box").selectionStart;var a=jQuery("#results_box").val();var b=a.substring(0,c-1).lastIndexOf(" ");jQuery("#results_box").val(a.substring(0,b)+" "+a.substring(c))}function backToLastWord(){var c=document.getElementById("results_box").selectionStart;var a=jQuery("#results_box").val();var b=a.substring(0,c-1).lastIndexOf(" ");setCaretToPos(document.getElementById("results_box"),b)}function goToEnd(){setCaretToPos(document.getElementById("results_box"),$("#results_box").val().length)}function setSelectionRange(b,c,d){if(b.setSelectionRange){b.focus();b.setSelectionRange(c,d)}else{if(b.createTextRange){var a=b.createTextRange();a.collapse(true);a.moveEnd("character",d);a.moveStart("character",c);a.select()}}}function setCaretToPos(a,b){setSelectionRange(a,b,b)}function upgrade(){start_button.style.visibility="hidden";}function localSave(){if(isDisplayingPlaceholder){return}var a=$("#results_box").val();if((JSON.stringify(localStorage).length+a.length)/1000000>2.2){alert("We were unable to save since you ran out of storage space in your browser. You can clear space by deleting older sessions saved in your browser, or uncheck 'Auto Save'.")}if(!variables.savedOnce&&a.length>1){variables.savedOnce=true;localStorage.sessionsList2+=currentSessionIndex+","}localStorage.setItem("session_title2_"+currentSessionIndex,session_title.innerText);localStorage.setItem("session2_"+currentSessionIndex,$("#results_box").val());sessionsDropdown()}function deleteSession(b){var a="";if(currentSessionIndex==parseInt(b)){initializeNewSession()}a=b+",";localStorage.sessionsList2=localStorage.sessionsList2.replace(a,"");localStorage.removeItem("session2_"+b);localStorage.removeItem("session_title2_"+b);sessionsDropdown()}function newButton(){pauseRecognition();initializeNewSession()}function loadSession(b,a){pauseRecognition();discardPlaceholder();if(localStorage.getItem("session2_"+b)!==null){initializeNewSession();currentSessionIndex=parseInt(b);variables.savedOnce=true;session_title.innerHTML=localStorage.getItem("session_title2_"+b);insertText(localStorage.getItem("session2_"+b))}else{initializeNewSession();session_title.innerHTML=a;insertText(b)}}function pauseRecognition(){if(variables.recognizing){variables.intentionalPause=true;recognition.stop()}}function toastNotification(b){var a=1000+b.length/5*150;notification.innerHTML=b;$("#notification").fadeIn(1000,function(){$("#notification").delay(a).fadeOut(1000)})}function alertNotification(b,a){bindEsc();info.innerHTML=b;$("#alert_container").fadeIn(500);if(typeof a==="string"){alert_title.innerHTML=a}else{alert_title.innerHTML="Please note..."}}function toggleHelpPane(){if(localStorage.getItem("toggleHelpPane")==="show"){localStorage.setItem("toggleHelpPane","hide");$("#application_pane").animate({right:0},700,function(){});$("#help_pane").css({display:"none"})}else{localStorage.setItem("toggleHelpPane","show");$("#application_pane").animate({right:"300px"},700,function(){$("#help_pane").css({display:"block"})})}}function copyButton(){window.getSelection().removeAllRanges();var b=document.querySelector("#results_box");b.focus();b.setSelectionRange(0,b.value.length);try{var c=document.execCommand("copy");toastNotification("Copied text to clipboard. <br>Now you can simply paste it anywhere.")}catch(a){toastNotification("Oops, unable to copy. You can still copy by manually selecting the text & Ctrl+C")}}function saveAsTxtFile(){var b="";b+=session_title.innerText+"\n-------------------\n";b+=$("#results_box").val();b+="\n\nSpeechnotes :) https://speechnotes.co";var e=b;var d=session_title.innerText+".txt";e=e.replace(/\n/g,"\r\n");var c=new Blob([e],{type:"text/plain;charset=utf-8"});var a=document.createElement("a");a.setAttribute("id","downloadLink_id");a.download=d;a.innerHTML="Download File";a.href=window.webkitURL.createObjectURL(c);a.click();$("#downloadLink_id").remove()}function saveAsDocFile(){var b="";b+=session_title.innerText+"\n-------------------\n";b+=$("#results_box").val();b+="\n\nSpeechnotes :) https://speechnotes.co";var e=b;var d=session_title.innerText+".doc";e=e.replace(/\n/g,"\r\n");var c=new Blob([e],{type:"text/plain;charset=utf-8"});var a=document.createElement("a");a.setAttribute("id","downloadLink_id");a.download=d;a.innerHTML="Download File";a.href=window.webkitURL.createObjectURL(c);a.click();$("#downloadLink_id").remove()}function emailButton(){var a="";a+=session_title.innerText+"\n-------------------\n";a+=$("#results_box").val();a+="\n\nSpeechnotes :) https://speechnotes.co";var b="mailto:?subject="+encodeURI(session_title.innerText)+"&body="+encodeURIComponent(a);if(b.length>1200){b=b.substring(0,1200);var c=b.split("%");b=b.split("%",c.length-1).join("%");alert("We're sorry, but the text was too long for your browser to automatically export, so we had to cut off the last part. If you need the whole text, please copy and paste it in manually.")}window.open(b,"_blank")}function printButton(){var b="";b+=session_title.innerText+"<br>-------------------<br>";b+=$("#results_box").val();b+="<br><br>Speechnotes :) https://speechnotes.co";b=b.replace(/\n/g,"<br>");var a=window.open("","print to","height=400,width=600");a.document.write("<html><head><title>print to</title>");a.document.write("</head><body >");a.document.write(b);a.document.write("</body></html>");a.document.close();a.focus();a.print();a.close();return true}function saveToDrive(){var a="";a+=session_title.innerText+"\n-------------------\n";a+=$("#results_box").val();a+="\n\nSpeechnotes :) https://speechnotes.co";checkAuth2();return true}function saveButton(){localSave();toastNotification("Session saved. <br><br>To load, go to the open button.")};
